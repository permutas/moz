<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adicionar Nome</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-image: linear-gradient(to right, #4facfe, #00f2fe);
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: #333;
      padding: 10px;
    }
    .container {
      max-width: 400px;
      background: linear-gradient(to right, #4facfe, #00f2fe);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      margin-top: 300px
    }
    input, select {
      margin: 10px 0;
      padding: 15px;
      width: 100%;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .btn-custom {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
    }
    #processingMessage {
      font-size: 24px;
      color: white;
    }
  </style>
</head>
<body>
<div class="container" id="mainContainer" style="display: none;">
  <h2>Adicione os seguintes dados:</h2>
  <div id="nameSection">

    <select id="ministerioInput" class="form-control" required>
      <option value="">Ministério</option>
      <option value="Ministério da Educação e Cultura">Ministério de Educação e Cultura</option>
    </select>

    <input type="text" id="nameInput" class="form-control" placeholder="Nome Completo" required>

    <select id="carreiraInput" class="form-control" required>
      <option value="">Categoria</option>
      <option value="Carreira1">DN1</option>
      <option value="Carreira2">DN2</option>
      <option value="Carreira3">DN3</option>
      <option value="Carreira4">DN4</option>
      <option value="Carreira5">DN5</option>
      <option value="Carreira16">DN6</option>
      <option value="Carreira6">Inst. e Tecn. Ped. DN1</option>
      <option value="Carreira7">Inst. Tecn. e Ped. DN2</option>
      <option value="Carreira8">Inst. e Tecn. Ped. DN3</option>
      <option value="Carreira9">Inst. e Tecn. Ped. DN4</option>
      <option value="Carreira10">Inst. e Tecn. Ped. DN5</option>
      <option value="Carreira11">Inst. Tecn. Ped. DN1</option>
      <option value="Carreira12">Tecn. Sup. em Adm. Pub.</option>
      <option value="Carreira13">Tecn. Prof. em Adm. Pub.</option>
      <option value="Carreira14">Ass. tecn.</option>
      <option value="Carreira15">Auxiliar</option>
    </select>

    <select id="classeInput" class="form-control" required>
      <option value="">Classe</option>
      <option value="Classe A">A</option>
      <option value="Classe B">B</option>
      <option value="Classe C">C</option>
      <option value="Classe D">D</option>
      <option value="Classe E">E</option>
      <option value="Classe U">U</option>
    </select>

    <select id="escalaoInput" class="form-control" required>
      <option value="">Escalão</option>
      <option value="Escalão 1">1</option>
      <option value="Escalão 2">2</option>
      <option value="Escalão 3">3</option>
      <option value="Escalão 4">4</option>
      <option value="Escalão 5">5</option>
      <option value="Escalão 6">6</option>
    </select>

    <select id="nomeacaoInput" class="form-control" required>
      <option value="">Nomeação</option>
      <option value="Nomeacao1">Provisoria</option>
      <option value="Nomeacao2">Definitiva</option>
    </select>

    <select id="provinciaInput" class="form-control" required>
      <option value="">Província de trabalho</option>
      <option value="Manica">Manica</option>
      <option value="Sofala">Sofala</option>
      <option value="Tete">Tete</option>
      <option value="Zambezia">Zambezia</option>
      <option value="Cabo_Delgado">Cabo Delgado</option>
      <option value="Niassa">Niassa</option>
      <option value="Nampula">Nampula</option>
      <option value="Gaza">Gaza</option>
      <option value="Inhambane">Inhambane</option>
      <option value="Maputo_Cidade">Maputo Cidade</option>
      <option value="Maputo_Provincia">Maputo Provincia</option>
    </select>

    <select id="distritoInput" class="form-control" required>
      <option value="">Distrito de trabalho</option>
    </select>

    <input type="text" id="celularContatoInput" class="form-control" placeholder="Contacto 1" maxlength="9" required>
    <input type="text" id="celularPessoalInput" class="form-control" placeholder="Contacto 2 (Opcional)" maxlength="9">

    <!-- Novo campo de informações adicionais -->
    <textarea id="informacoesAdicionaisInput" class="form-control" placeholder="Informações adicionais" rows="4"></textarea>

    <select id="localDistritoInput" class="form-control">
      <option value="">Distritos pretendidos</option>
      <option value="Alto Molocue">Alto Molocue</option>
      <option value="Ancuabe">Ancuabe</option>
      <option value="Angoche">Angoche</option>
      <option value="Angonia">Angonia</option>
      <option value="Balama">Balama</option>
      <option value="Barue">Barue</option>
      <option value="Beira">Beira</option>
      <option value="Bilene">Bilene</option>
      <option value="Boane">Boane</option>
      <option value="Buzi">Buzi</option>
      <option value="Cahora-Bassa">Cahora-Bassa</option>
      <option value="Caia">Caia</option>
      <option value="Changara">Changara</option>
      <option value="Chemba">Chemba</option>
      <option value="Cheringoma">Cheringoma</option>
      <option value="Chibabava">Chibabava</option>
      <option value="Chibuto">Chibuto</option>
      <option value="Chicualacuala">Chicualacuala</option>
      <option value="Chifunde">Chifunde</option>
      <option value="Chigubo">Chigubo</option>
      <option value="Chimbonila">Chimbonila</option>
      <option value="Chimoio">Chimoio</option>
      <option value="Chinde">Chinde</option>
      <option value="Chiure">Chiure</option>
      <option value="Chiuta">Chiuta</option>
      <option value="Chokwe">Chokwe</option>
      <option value="Chongoene">Chongoene</option>
      <option value="Cuamba">Cuamba</option>
      <option value="Derre">Derre</option>
      <option value="Distrito Municipal de KaNyaka">Distrito Municipal de KaNyaka</option>
      <option value="Distrito Municipal de KaTembe">Distrito Municipal de KaTembe</option>
      <option value="Distrito Urbano de KaMavota">Distrito Urbano de KaMavota</option>
      <option value="Distrito Urbano de KaMaxaquene">Distrito Urbano de KaMaxaquene</option>
      <option value="Distrito Urbano de KaMpfumo">Distrito Urbano de KaMpfumo</option>
      <option value="Distrito Urbano de KaMubukwana">Distrito Urbano de KaMubukwana</option>
      <option value="Distrito Urbano de Nlhamankulu">Distrito Urbano de Nlhamankulu</option>
      <option value="Doa">Doa</option>
      <option value="Dondo">Dondo</option>
      <option value="Erati">Erati</option>
      <option value="Funhalouro">Funhalouro</option>
      <option value="Gile">Gile</option>
      <option value="Gondola">Gondola</option>
      <option value="Gorongosa">Gorongosa</option>
      <option value="Govuro">Govuro</option>
      <option value="Guija">Guija</option>
      <option value="Guro">Guro</option>
      <option value="Gurue">Gurue</option>
      <option value="Homoine">Homoine</option>
      <option value="Ibo">Ibo</option>
      <option value="Ile">Ile</option>
      <option value="Ilha de Moçambique">Ilha de Moçambique</option>
      <option value="Inhambane">Inhambane</option>
      <option value="Inharrime">Inharrime</option>
      <option value="Inhassoro">Inhassoro</option>
      <option value="Inhassunge">Inhassunge</option>
      <option value="Jangamo">Jangamo</option>
      <option value="Lago">Lago</option>
      <option value="Lalaua">Lalaua</option>
      <option value="Larde">Larde</option>
      <option value="Lichinga">Lichinga</option>
      <option value="Limpopo">Limpopo</option>
      <option value="Liupo">Liupo</option>
      <option value="Luabo">Luabo</option>
      <option value="Lugela">Lugela</option>
      <option value="Mabalane">Mabalane</option>
      <option value="Mabote">Mabote</option>
      <option value="Macanga">Macanga</option>
      <option value="Macate">Macate</option>
      <option value="Machanga">Machanga</option>
      <option value="Machaze">Machaze</option>
      <option value="Macomia">Macomia</option>
      <option value="Macossa">Macossa</option>
      <option value="Maganja da Costa">aganja da Costa</option>
      <option value="Magoe">Magoe</option>
      <option value="Magude">Magude</option>
      <option value="Majune">Majune</option>
      <option value="Malema">Malema</option>
      <option value="Mandimba">Mandimba</option>
      <option value="Manhica">Manhica</option>
      <option value="Manica">Manica</option>
      <option value="Manjacaze">Manjacaze</option>
      <option value="Mapai">Mapai</option>
      <option value="Marara">Marara"</option>
      <option value="Maravia">Maravia</option>
      <option value="Maringue">Maringue</option>
      <option value="Marracuene">Marracuene</option>
      <option value="Marromeu">Marromeu</option>
      <option value="Marrupa">Marrupa</option>
      <option value="Massangena">Massangena</option>
      <option value="Massinga">Massinga</option>
      <option value="Massingir">Massingir</option>
      <option value="Matola">Matola</option>
      <option value="Matutuine">Matutuine"</option>
      <option value="Maua">Maua</option>
      <option value="Mavago">Mavago</option>
      <option value="Maxixe">Maxixe</option>
      <option value="Mecanhelas">Mecanhelas</option>
      <option value="Meconta">Meconta</option>
      <option value="Mecuburi">Mecuburi</option>
      <option value="Mecufi">Mecufi</option>
      <option value="Mecula">Mecula</option>
      <option value="Meluco">Meluco</option>
      <option value="Memba">Memba</option>
      <option value="Metarica">Metarica</option>
      <option value="Metuge">Metuge</option>
      <option value="Milange">Milange</option>
      <option value="Moamba">Moamba</option>
      <option value="Moatize">Moatize</option>
      <option value="Mocimboa da Praia">Mocimboa da Praia</option>
      <option value="Mocuba">Mocuba</option>
      <option value="Mocubela">Mocubela</option>
      <option value="Mogincual">Mogincual</option>
      <option value="Mogovolas">Mogovolas</option>
      <option value="Molumbo">Molumbo</option>
      <option value="Moma">Moma</option>
      <option value="Monapo">Monapo</option>
      <option value="Montepuez">Montepuez</option>
      <option value="Mopeia">Mopeia</option>
      <option value="Morrumbala">Morrumbala</option>
      <option value="Morrumbene"></option>
      <option value="Mossuril">Morrumbene</option>
      <option value="Mossurize">Mossurize</option>
      <option value="Muanza">Muanza</option>
      <option value="Muecate">Muecate</option>
      <option value="Mueda">Mueda</option>
      <option value="Muembe">Muembe</option>
      <option value="Muidumbe">Muidumbe</option>
      <option value="Mulevala">Mulevala</option>
      <option value="Murrupula">Murrupula</option>
      <option value="Mutarara">Mutarara</option>
      <option value="Nacala Porto">Nacala Porto</option>
      <option value="Nacala-a-Velha">Nacala-a-Velha</option>
      <option value="Nacaroa">Nacaroa</option>
      <option value="Namaacha">Namaacha</option>
      <option value="Namacurra">Namacurra</option>
      <option value="Namarroi">Namarroi</option>
      <option value="Nampula">Nampula</option>
      <option value="Namuno">Namuno</option>
      <option value="Nangade">Nangade</option>
      <option value="N'gauma">N'gauma</option>
      <option value="Nhamatanda">Nhamatanda</option>
      <option value="Nicoadala">Nicoadala</option>
      <option value="Nipepe">Nipepe</option>
      <option value="Palma">Palma</option>
      <option value="Panda">Panda</option>
      <option value="Pebane">Pebane</option>
      <option value="Pemba">Pemba</option>
      <option value="Quelimane">Quelimane</option>
      <option value="Quissanga"></option>
      <option value="Rapale">Quissanga</option>
      <option value="Ribaue">Ribaue</option>
      <option value="Sanga">Sanga</option>
      <option value="Sussundenga">Sussundenga</option>
      <option value="Tambara">Tambara</option>
      <option value="Tete">Tete</option>
      <option value="Tsangano">Tsangano</option>
      <option value="Vanduzi">Vanduzi</option>
      <option value="Vilanculos">Vilanculos</option>
      <option value="Xai-Xai">Xai-Xai</option>
      <option value="Zavala">Zavala</option>
      <option value="Zumbo">Zumbo</option>
    </select>

    <input type="text" id="petendidoInput" class="form-control" placeholder="Local pretendido" required readonly>
    <input type="hidden" id="contactadoInput" value="não">

    <button id="submitButton" class="btn btn-primary mt-3 d-block mx-auto">OK</button>
    <a href="logout.html" style="text-decoration: underline; display: block; text-align: center;">Terminar sessão</a>
  </div>
  <p id="message" class="mt-3"></p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBisN5rWYAm1RULEtLt2Rr5rTOwoJoobyw",
    authDomain: "permutas-70e20.firebaseapp.com",
    projectId: "permutas-70e20",
    storageBucket: "permutas-70e20.appspot.com",
    messagingSenderId: "675438868569",
    appId: "1:675438868569:web:d46be8ea0e68c999505948"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  async function checkUserData() {
    const user = auth.currentUser;

    if (user) {
      const userDocRef = doc(db, 'users', user.uid);
      const userDocSnapshot = await getDoc(userDocRef);

      if (userDocSnapshot.exists() && userDocSnapshot.data().name) {
        window.location.href = 'home.html';
      } else {
        document.getElementById('mainContainer').style.display = 'block';
      }
    } else {
      document.getElementById('mainContainer').style.display = 'block';
    }
  }

  auth.onAuthStateChanged((user) => {
    checkUserData();
  });

  // Lógica para atualizar o distrito com base na província selecionada
  const provinciaDistritosTrabalho = {
    "Manica": ["Tambara", "Barue", "Macossa", "Guro", "Vanduzi", "Chimoio", "Manica", "Gondola", "Macate", "Sussundenga", "Mossurize", "Machaze"],
    "Sofala": ["Beira", "Buzi", "Caia", "Chemba", "Cheringoma", "Chibabava", "Dondo", "Gorongosa", "Machanga", "Maringue", "Marromeu", "Muanza", "Nhamatanda"],
    "Tete": ["Angonia", "Cahora-Bassa", "Changara", "Chifunde", "Chiuta", "Doa", "Macanga", "Magoe", "Marara", "Maravia", "Moatize", "Mutarara", "Tete", "Tsangano", "Zumbo"],
    "Zambezia": ["Alto Molocue", "Chinde", "Derre", "Gile", "Gurue", "Ile", "Inhassunge", "Luabo", "Lugela", "Maganja da Costa", "Milange", "Mocuba", "Mocubela", "Molumbo", "Mopeia", "Morrumbala", "Mulevala", "Namacura", "Namarroi", "Nicoadala", "Pebane", "Quelimane"],
    "Cabo_Delgado": ["Ancuabe", "Balama", "Chiure", "Ibo", "Macomia", "Mecufi", "Meluco", "Metuge", "Mocimboa da Praia", "Montepuez", "Mueda", "Muidumbe", "Namuno", "Nangade", "Palma", "Pemba", "Quissanga"],
    "Niassa": ["Chimbonila", "Cuamba", "Lago", "Lichinga", "Majune", "Mandimba", "Marrupa", "Maua", "Mavago", "Mecanhelas", "Mecula", "Metarica", "Muembe", "N'gauma", "Nipepe", "Sanga"],
    "Nampula": ["Angoche", "Erati", "Ilha de Mocambique", "Lalaua", "Larde", "Liupo", "Malema", "Meconta", "Mecuburi", "Memba", "Mogincual", "Mogovolas", "Moma", "Monapo", "Mossuril", "Muecate", "Murrupula", "Nacala-a-Velha", "Nacala Porto", "Nacaroa", "Nampula", "Rapale", "Ribaue"],
    "Gaza": ["Bilene", "Chibuto", "Chicualacuala", "Chigubo", "Chokwe", "Chongoene", "Guija", "Limpopo", "Mabalane", "Manjacaze", "Mapai", "Massangena", "Massingir", "Xai-Xai"],
    "Inhambane": ["Funhalouro", "Govuro", "Homoine", "Inhamabane", "Inharrime", "Inhassoro", "Jangamo", "Mabote", "Massinga", "Maxixe", "Morrumbene", "Panda", "Vilanculos", "Zavala"],
    "Maputo_Cidade": ["Distrito Urbano de KaMpfumo", "Distrito Urbano de NIhamankulu", "Distrito Urbano de KaMaxaquene", "Distrito Urbano de KaMavota", "Distrito Urbano de KaMubukwana", "Distrito Municipal de KaTembe", "Distrito Municipal de KaNyaka"],
    "Maputo_Provincia": ["Boane", "Magude", "Manhica", "Marracuene", "Matola", "Matutuine", "Moamba", "Namaacha"]
  };

  document.getElementById('provinciaInput').addEventListener('change', () => {
    const prov = document.getElementById('provinciaInput').value;
    const distritoSelect = document.getElementById('distritoInput');
    distritoSelect.innerHTML = '<option value="">Selecione o distrito</option>';
    if (provinciaDistritosTrabalho[prov]) {
      provinciaDistritosTrabalho[prov].forEach(d => {
        const option = document.createElement('option');
        option.value = d;
        option.textContent = d;
        distritoSelect.appendChild(option);
      });
    }
  });

  let distritosSelecionados = [];

  document.getElementById('localDistritoInput').addEventListener('change', () => {
    const val = document.getElementById('localDistritoInput').value;

    if (val && !distritosSelecionados.includes(val)) {
      distritosSelecionados.push(val);
      document.getElementById('localDistritoInput').value = "";
      document.getElementById('localDistritoInput').options[0].text = "Adicione outro distrito pretendido";
    }
    document.getElementById('petendidoInput').value = distritosSelecionados.join(', ');
  });

  document.getElementById('submitButton').addEventListener('click', async () => {
    const ministerio = document.getElementById('ministerioInput').selectedOptions[0].text.trim();
    const name = document.getElementById('nameInput').value.trim();
    const carreira = document.getElementById('carreiraInput').selectedOptions[0].text.trim();
    const classe = document.getElementById('classeInput').selectedOptions[0].text.trim();
    const escalao = document.getElementById('escalaoInput').selectedOptions[0].text.trim();
    const nomeacao = document.getElementById('nomeacaoInput').selectedOptions[0].text.trim();
    const provincia = document.getElementById('provinciaInput').selectedOptions[0].text.trim();
    const distrito = document.getElementById('distritoInput').selectedOptions[0].text.trim();
    const petendido = document.getElementById('petendidoInput').value.trim();
    const celularContato = document.getElementById('celularContatoInput').value.trim();
    const celularPessoal = document.getElementById('celularPessoalInput').value.trim();
    const informacoesAdicionais = document.getElementById('informacoesAdicionaisInput').value.trim();
    const contactado = document.getElementById('contactadoInput').value;
    const user = auth.currentUser;

    if (user && ministerio && name && carreira && classe && escalao && nomeacao && provincia && distrito && celularContato) {
      try {
        const userData = {
          email: user.email,
          ministerio,
          name,
          carreira,
          classe,
          escalao,
          nomeacao,
          provincia,
          distrito,
          petendido,
          celular_contato: celularContato,
          celular_pessoal: celularPessoal || null,
          informacoes_adicionais: informacoesAdicionais,
          contactado
        };

        await setDoc(doc(db, 'users', user.uid), userData);
        window.location.href = 'home.html';
      } catch (error) {
        console.error(error);
        document.getElementById('message').textContent = 'Erro ao salvar dados';
        document.getElementById('message').style.color = 'red';
      }
    } else {
      document.getElementById('message').textContent = 'Por favor, preencha todos os campos obrigatórios.';
      document.getElementById('message').style.color = 'red';
    }
  });
</script>

</body>
</html>
