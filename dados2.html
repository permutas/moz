<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atualizar Dados</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-image: linear-gradient(to right, #4facfe, #00f2fe);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 500px;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
      max-height: 95vh;
    }
    input, select, textarea {
      margin: 10px 0;
      padding: 12px;
      width: 100%;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .btn-custom {
      margin-top: 15px;
      width: 100%;
    }
  </style>
</head>
<body>
<div class="container">
  <h3>Atualizar seus dados</h3>
  <form id="formulario">

    <select id="ministerioInput" required>
      <option value="">Ministério</option>
      <option value="Ministério da Educação e Cultura">Ministério da Educação e Cultura</option>
    </select>

    <input type="text" id="nameInput" placeholder="Nome Completo" required>

    <select id="carreiraInput" required>
      <option value="">Categoria</option>
      <option value="DN1">DN1</option>
      <option value="DN2">DN2</option>
      <option value="DN3">DN3</option>
      <option value="DN4">DN4</option>
      <option value="DN5">DN5</option>
      <option value="DN6">DN6</option>
      <option value="Inst. e Tecn. Ped. DN1">Inst. e Tecn. Ped. DN1</option>
      <option value="Inst. Tecn. e Ped. DN2">Inst. Tecn. e Ped. DN2</option>
      <option value="Inst. e Tecn. Ped. DN3">Inst. e Tecn. Ped. DN3</option>
      <option value="Inst. e Tecn. Ped. DN4">Inst. e Tecn. Ped. DN4</option>
      <option value="Inst. e Tecn. Ped. DN5">Inst. e Tecn. Ped. DN5</option>
      <option value="Inst. Tecn. Ped. DN1">Inst. Tecn. Ped. DN1</option>
      <option value="Tecn. Sup. em Adm. Pub.">Tecn. Sup. em Adm. Pub.</option>
      <option value="Tecn. Prof. em Adm. Pub.">Tecn. Prof. em Adm. Pub.</option>
      <option value="Ass. tecn.">Ass. tecn.</option>
      <option value="Auxiliar">Auxiliar</option>
    </select>

    <select id="classeInput" required>
      <option value="">Classe</option>
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>
      <option value="E">E</option>
      <option value="U">U</option>
    </select>

    <select id="escalaoInput" required>
      <option value="">Escalão</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>

    <select id="nomeacaoInput" required>
      <option value="">Nomeação</option>
      <option value="Provisoria">Provisória</option>
      <option value="Definitiva">Definitiva</option>
    </select>

    <select id="provinciaInput" class="form-control" required>
      <option value="">Província de trabalho</option>
      <option value="Manica">Manica</option>
      <option value="Sofala">Sofala</option>
      <option value="Tete">Tete</option>
      <option value="Zambezia">Zambezia</option>
      <option value="Cabo Delgado">Cabo Delgado</option>
      <option value="Niassa">Niassa</option>
      <option value="Nampula">Nampula</option>
      <option value="Gaza">Gaza</option>
      <option value="Inhambane">Inhambane</option>
      <option value="Maputo Cidade">Maputo Cidade</option>
      <option value="Maputo Provincia">Maputo Provincia</option>
    </select>

    <select id="distritoInput" required>
      <option value="">Selecione o distrito</option>
    </select>

    <input type="text" id="celularContatoInput" placeholder="Contacto WhatsApp" maxlength="9" required>
    <input type="text" id="celularPessoalInput" placeholder="Contacto chamadas (opcional)" maxlength="9">

    <textarea id="informacoesAdicionaisInput" placeholder="Informações adicionais" rows="4"></textarea>

    <select id="localDistritoInput">
      <option value="">Selecione outro distrito</option>
      <option value="">Distritos pretendidos</option>
      <option value="Alto Molocue">Alto Molocue</option>
      <option value="Ancuabe">Ancuabe</option>
      <option value="Angoche">Angoche</option>
      <option value="Angonia">Angonia</option>
      <option value="Balama">Balama</option>
      <option value="Barue">Barue</option>
      <option value="Beira">Beira</option>
      <option value="Bilene">Bilene</option>
      <option value="Boane">Boane</option>
      <option value="Buzi">Buzi</option>
      <option value="Cahora-Bassa">Cahora-Bassa</option>
      <option value="Caia">Caia</option>
      <option value="Changara">Changara</option>
      <option value="Chemba">Chemba</option>
      <option value="Cheringoma">Cheringoma</option>
      <option value="Chibabava">Chibabava</option>
      <option value="Chibuto">Chibuto</option>
      <option value="Chicualacuala">Chicualacuala</option>
      <option value="Chifunde">Chifunde</option>
      <option value="Chigubo">Chigubo</option>
      <option value="Chimbonila">Chimbonila</option>
      <option value="Chimoio">Chimoio</option>
      <option value="Chinde">Chinde</option>
      <option value="Chiure">Chiure</option>
      <option value="Chiuta">Chiuta</option>
      <option value="Chokwe">Chokwe</option>
      <option value="Chongoene">Chongoene</option>
      <option value="Cuamba">Cuamba</option>
      <option value="Derre">Derre</option>
      <option value="Distrito Municipal de KaNyaka">Distrito Municipal de KaNyaka</option>
      <option value="Distrito Municipal de KaTembe">Distrito Municipal de KaTembe</option>
      <option value="Distrito Urbano de KaMavota">Distrito Urbano de KaMavota</option>
      <option value="Distrito Urbano de KaMaxaquene">Distrito Urbano de KaMaxaquene</option>
      <option value="Distrito Urbano de KaMpfumo">Distrito Urbano de KaMpfumo</option>
      <option value="Distrito Urbano de KaMubukwana">Distrito Urbano de KaMubukwana</option>
      <option value="Distrito Urbano de Nlhamankulu">Distrito Urbano de Nlhamankulu</option>
      <option value="Doa">Doa</option>
      <option value="Dondo">Dondo</option>
      <option value="Erati">Erati</option>
      <option value="Funhalouro">Funhalouro</option>
      <option value="Gile">Gile</option>
      <option value="Gondola">Gondola</option>
      <option value="Gorongosa">Gorongosa</option>
      <option value="Govuro">Govuro</option>
      <option value="Guija">Guija</option>
      <option value="Guro">Guro</option>
      <option value="Gurue">Gurue</option>
      <option value="Homoine">Homoine</option>
      <option value="Ibo">Ibo</option>
      <option value="Ile">Ile</option>
      <option value="Ilha de Moçambique">Ilha de Moçambique</option>
      <option value="Inhambane">Inhambane</option>
      <option value="Inharrime">Inharrime</option>
      <option value="Inhassoro">Inhassoro</option>
      <option value="Inhassunge">Inhassunge</option>
      <option value="Jangamo">Jangamo</option>
      <option value="Lago">Lago</option>
      <option value="Lalaua">Lalaua</option>
      <option value="Larde">Larde</option>
      <option value="Lichinga">Lichinga</option>
      <option value="Limpopo">Limpopo</option>
      <option value="Liupo">Liupo</option>
      <option value="Luabo">Luabo</option>
      <option value="Lugela">Lugela</option>
      <option value="Mabalane">Mabalane</option>
      <option value="Mabote">Mabote</option>
      <option value="Macanga">Macanga</option>
      <option value="Macate">Macate</option>
      <option value="Machanga">Machanga</option>
      <option value="Machaze">Machaze</option>
      <option value="Macomia">Macomia</option>
      <option value="Macossa">Macossa</option>
      <option value="Maganja da Costa">aganja da Costa</option>
      <option value="Magoe">Magoe</option>
      <option value="Magude">Magude</option>
      <option value="Majune">Majune</option>
      <option value="Malema">Malema</option>
      <option value="Mandimba">Mandimba</option>
      <option value="Manhica">Manhica</option>
      <option value="Manica">Manica</option>
      <option value="Manjacaze">Manjacaze</option>
      <option value="Mapai">Mapai</option>
      <option value="Marara">Marara"</option>
      <option value="Maravia">Maravia</option>
      <option value="Maringue">Maringue</option>
      <option value="Marracuene">Marracuene</option>
      <option value="Marromeu">Marromeu</option>
      <option value="Marrupa">Marrupa</option>
      <option value="Massangena">Massangena</option>
      <option value="Massinga">Massinga</option>
      <option value="Massingir">Massingir</option>
      <option value="Matola">Matola</option>
      <option value="Matutuine">Matutuine"</option>
      <option value="Maua">Maua</option>
      <option value="Mavago">Mavago</option>
      <option value="Maxixe">Maxixe</option>
      <option value="Mecanhelas">Mecanhelas</option>
      <option value="Meconta">Meconta</option>
      <option value="Mecuburi">Mecuburi</option>
      <option value="Mecufi">Mecufi</option>
      <option value="Mecula">Mecula</option>
      <option value="Meluco">Meluco</option>
      <option value="Memba">Memba</option>
      <option value="Metarica">Metarica</option>
      <option value="Metuge">Metuge</option>
      <option value="Milange">Milange</option>
      <option value="Moamba">Moamba</option>
      <option value="Moatize">Moatize</option>
      <option value="Mocimboa da Praia">Mocimboa da Praia</option>
      <option value="Mocuba">Mocuba</option>
      <option value="Mocubela">Mocubela</option>
      <option value="Mogincual">Mogincual</option>
      <option value="Mogovolas">Mogovolas</option>
      <option value="Molumbo">Molumbo</option>
      <option value="Moma">Moma</option>
      <option value="Monapo">Monapo</option>
      <option value="Montepuez">Montepuez</option>
      <option value="Mopeia">Mopeia</option>
      <option value="Morrumbala">Morrumbala</option>
      <option value="Morrumbene">Morrumbene</option>
      <option value="Mossuril">Mossuril</option>
      <option value="Mossurize">Mossurize</option>
      <option value="Muanza">Muanza</option>
      <option value="Muecate">Muecate</option>
      <option value="Mueda">Mueda</option>
      <option value="Muembe">Muembe</option>
      <option value="Muidumbe">Muidumbe</option>
      <option value="Mulevala">Mulevala</option>
      <option value="Murrupula">Murrupula</option>
      <option value="Mutarara">Mutarara</option>
      <option value="Nacala Porto">Nacala Porto</option>
      <option value="Nacala-a-Velha">Nacala-a-Velha</option>
      <option value="Nacaroa">Nacaroa</option>
      <option value="Namaacha">Namaacha</option>
      <option value="Namacurra">Namacurra</option>
      <option value="Namarroi">Namarroi</option>
      <option value="Nampula">Nampula</option>
      <option value="Namuno">Namuno</option>
      <option value="Nangade">Nangade</option>
      <option value="N'gauma">N'gauma</option>
      <option value="Nhamatanda">Nhamatanda</option>
      <option value="Nicoadala">Nicoadala</option>
      <option value="Nipepe">Nipepe</option>
      <option value="Palma">Palma</option>
      <option value="Panda">Panda</option>
      <option value="Pebane">Pebane</option>
      <option value="Pemba">Pemba</option>
      <option value="Quelimane">Quelimane</option>
      <option value="Quissanga">Quissanga</option>
      <option value="Rapale">Rapale</option>
      <option value="Ribaue">Ribaue</option>
      <option value="Sanga">Sanga</option>
      <option value="Sussundenga">Sussundenga</option>
      <option value="Tambara">Tambara</option>
      <option value="Tete">Tete</option>
      <option value="Tsangano">Tsangano</option>
      <option value="Vanduzi">Vanduzi</option>
      <option value="Vilanculos">Vilanculos</option>
      <option value="Xai-Xai">Xai-Xai</option>
      <option value="Zavala">Zavala</option>
      <option value="Zumbo">Zumbo</option>
    </select>

    <input type="text" id="petendidoInput" placeholder="Locais pretendidos separados por vírgula" readonly>

    <button type="submit" class="btn btn-primary btn-custom">Atualizar</button>
    <p id="message" class="text-danger"></p>
  </form>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBisN5rWYAm1RULEtLt2Rr5rTOwoJoobyw",
    authDomain: "permutas-70e20.firebaseapp.com",
    projectId: "permutas-70e20",
    storageBucket: "permutas-70e20.appspot.com",
    messagingSenderId: "675438868569",
    appId: "1:675438868569:web:d46be8ea0e68c999505948"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Lógica para atualizar o distrito com base na província selecionada
  const provinciaDistritosTrabalho = {
    "Manica": ["Tambara", "Barue", "Macossa", "Guro", "Vanduzi", "Chimoio", "Manica", "Gondola", "Macate", "Sussundenga", "Mossurize", "Machaze"],
    "Sofala": ["Beira", "Buzi", "Caia", "Chemba", "Cheringoma", "Chibabava", "Dondo", "Gorongosa", "Machanga", "Maringue", "Marromeu", "Muanza", "Nhamatanda"],
    "Tete": ["Angonia", "Cahora-Bassa", "Changara", "Chifunde", "Chiuta", "Doa", "Macanga", "Magoe", "Marara", "Maravia", "Moatize", "Mutarara", "Tete", "Tsangano", "Zumbo"],
    "Zambezia": ["Alto Molocue", "Chinde", "Derre", "Gile", "Gurue", "Ile", "Inhassunge", "Luabo", "Lugela", "Maganja da Costa", "Milange", "Mocuba", "Mocubela", "Molumbo", "Mopeia", "Morrumbala", "Mulevala", "Namacura", "Namarroi", "Nicoadala", "Pebane", "Quelimane"],
    "Cabo_Delgado": ["Ancuabe", "Balama", "Chiure", "Ibo", "Macomia", "Mecufi", "Meluco", "Metuge", "Mocimboa da Praia", "Montepuez", "Mueda", "Muidumbe", "Namuno", "Nangade", "Palma", "Pemba", "Quissanga"],
    "Niassa": ["Chimbonila", "Cuamba", "Lago", "Lichinga", "Majune", "Mandimba", "Marrupa", "Maua", "Mavago", "Mecanhelas", "Mecula", "Metarica", "Muembe", "N'gauma", "Nipepe", "Sanga"],
    "Nampula": ["Angoche", "Erati", "Ilha de Mocambique", "Lalaua", "Larde", "Liupo", "Malema", "Meconta", "Mecuburi", "Memba", "Mogincual", "Mogovolas", "Moma", "Monapo", "Mossuril", "Muecate", "Murrupula", "Nacala-a-Velha", "Nacala Porto", "Nacaroa", "Nampula", "Rapale", "Ribaue"],
    "Gaza": ["Bilene", "Chibuto", "Chicualacuala", "Chigubo", "Chokwe", "Chongoene", "Guija", "Limpopo", "Mabalane", "Manjacaze", "Mapai", "Massangena", "Massingir", "Xai-Xai"],
    "Inhambane": ["Funhalouro", "Govuro", "Homoine", "Inhamabane", "Inharrime", "Inhassoro", "Jangamo", "Mabote", "Massinga", "Maxixe", "Morrumbene", "Panda", "Vilanculos", "Zavala"],
    "Maputo_Cidade": ["Distrito Urbano de KaMpfumo", "Distrito Urbano de NIhamankulu", "Distrito Urbano de KaMaxaquene", "Distrito Urbano de KaMavota", "Distrito Urbano de KaMubukwana", "Distrito Municipal de KaTembe", "Distrito Municipal de KaNyaka"],
    "Maputo_Provincia": ["Boane", "Magude", "Manhica", "Marracuene", "Matola", "Matutuine", "Moamba", "Namaacha"]
  };

  const distritosSelecionados = [];
  const inputDistritoPretendido = document.getElementById("petendidoInput");
  const localDistritoSelect = document.getElementById("localDistritoInput");

  localDistritoSelect.addEventListener("change", () => {
    const val = localDistritoSelect.value;
    if (val && !distritosSelecionados.includes(val)) {
      distritosSelecionados.push(val);
      inputDistritoPretendido.value = distritosSelecionados.join(", ");
    }
    localDistritoSelect.selectedIndex = 0;
  });

  const provInput = document.getElementById("provinciaInput");
  const distInput = document.getElementById("distritoInput");

  provInput.addEventListener("change", () => {
    const provSelecionada = provInput.value;
    const distritos = provinciaDistritosTrabalho[provSelecionada] || [];
    distInput.innerHTML = '<option value="">Selecione o distrito</option>';
    distritos.forEach(distrito => {
      const opt = document.createElement("option");
      opt.value = distrito;
      opt.textContent = distrito;
      distInput.appendChild(opt);
    });
  });

  auth.onAuthStateChanged(async (user) => {
    if (user) {
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        const data = snap.data();
        document.getElementById("nameInput").value = data.name || "";
        document.getElementById("celularContatoInput").value = data.celular_contato || "";
        document.getElementById("celularPessoalInput").value = data.celular_pessoal || "";
        document.getElementById("informacoesAdicionaisInput").value = data.informacoes_adicionais || "";
      }

      document.getElementById("formulario").addEventListener("submit", async (e) => {
        e.preventDefault();

        try {
          await updateDoc(ref, {
            ministerio: document.getElementById("ministerioInput").value,
            name: document.getElementById("nameInput").value,
            carreira: document.getElementById("carreiraInput").value,
            classe: document.getElementById("classeInput").value,
            escalao: document.getElementById("escalaoInput").value,
            nomeacao: document.getElementById("nomeacaoInput").value,
            provincia: document.getElementById("provinciaInput").value,
            distrito: document.getElementById("distritoInput").value,
            celular_contato: document.getElementById("celularContatoInput").value,
            celular_pessoal: document.getElementById("celularPessoalInput").value,
            informacoes_adicionais: document.getElementById("informacoesAdicionaisInput").value,
            petendido: inputDistritoPretendido.value
          });

          document.getElementById("message").textContent = "Dados atualizados com sucesso!";
          document.getElementById("message").classList.remove("text-danger");
          document.getElementById("message").classList.add("text-success");
        } catch (error) {
          console.error("Erro ao atualizar:", error);
          document.getElementById("message").textContent = "Erro ao atualizar os dados.";
        }
      });
    }
  });
</script>
</body>
</html>
